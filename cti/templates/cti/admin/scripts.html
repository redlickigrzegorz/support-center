<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.7/js/jquery.tablesorter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.28.7/js/jquery.tablesorter.widgets.js"></script>

<script>
    $(function(){
        $("#faultTable").tablesorter({
            sortList: [[0,1]]
        });
    });

    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip();
    });

    $(document).ready(function() {
        $('.fault-tr').click(function(event) {
            var id = $(this).attr('id');
            var content = $('<div class="options-menu">'+
                                '<div class="col-xs-3 col-sm-3 col-md-3 option">'+
                                    '<a href="" class="option-button details-button" title="details">'+
                                        '<span class="glyphicon glyphicon-file"></span>'+
                                    '</a>'+
                                '</div>'+
                                '<div class="col-xs-3 col-sm-3 col-md-3 option">'+
                                    '<a href="" class="option-button edit-button" title="edit">'+
                                        '<span class="glyphicon glyphicon-pencil"></span>'+
                                    '</a>'+
                                '</div>'+
                                '<div class="col-xs-3 col-sm-3 col-md-3 option">'+
                                    '<a href="" class="option-button assign-button" title="assign to me">'+
                                        '<span class="glyphicon glyphicon-plus"></span>'+
                                    '</a>'+
                                '</div>'+
                                '<div class="col-xs-3 col-sm-3 col-md-3 option">'+
                                    '<a href="" class="option-button delete-button" title="delete">'+
                                        '<span class="glyphicon glyphicon-trash"></span>'+
                                    '</a>'+
                                '</div>'+
                            '</div>');
            $("#options-modal").html(content).offset({ top: event.pageY, left: event.pageX});
        });
    });

    $(document).ready(function() {
        $('.menu-button').click(function(event) {
            $('.menu-button').removeClass('selected');
            $(this).addClass('selected');
            event.preventDefault();
        })
    });

    $(function() {
        $('#contact-button').click(function () {
            $('#phone_number').tooltip('hide');
            $('#object_number').tooltip('hide');
            $('#topic').tooltip('hide');
            $('#description').tooltip('hide');
        });
    });

    window.onclick = function(event) {
        if (!event.target.matches('.dropdown-button')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            var i;

            for (i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];

                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    };

    function dropdownFunction() {
        document.getElementById("myDropdown").classList.toggle("show");
    }

    function validateFault() {
        var validation = true;

        var phone_number = document.getElementById("phone_number").value;
        var object_number = document.getElementById("object_number").value;
        var topic = document.getElementById("topic").value;
        var description = document.getElementById("description").value;

        var phone_number_alert = document.getElementById("phone_number_alert");
        var object_number_alert = document.getElementById("object_number_alert");
        var topic_alert = document.getElementById("topic_alert");
        var description_alert = document.getElementById("description_alert");

        var object_number_regex = new RegExp("^([0-9]{10})$");
        var phone_number_regex = new RegExp("^([+]?[1]?[0-9]{9,15})$");

        $('#phone_number').tooltip({placement: 'right', title: '', trigger: 'manual'});
        $('#object_number').tooltip({placement: 'right', title: '', trigger: 'manual'});
        $('#topic').tooltip({placement: 'right', title: '', trigger: 'manual'});
        $('#description').tooltip({placement: 'right', title: '', trigger: 'manual'});

        if (!phone_number) {
            validation = false;
            $('#phone_number').attr('data-original-title', 'phone number is required')
                              .tooltip('fixTitle')
                              .tooltip('show');
        }
        else {
            if (!phone_number_regex.test(phone_number)) {
                validation = false;
                $('#phone_number').attr('data-original-title', 'allowed phone number format: +999999999 (9-15 digits with possible plus)')
                                  .tooltip('fixTitle')
                                  .tooltip('show');
            }
            else {
                $('#phone_number').tooltip('hide');
            }
        }

        if (!object_number) {
            validation = false;
            $('#object_number').attr('data-original-title', 'object number is required')
                               .tooltip('fixTitle')
                               .tooltip('show');
        }
        else {
            if (!object_number_regex.test(object_number)) {
                validation = false;
                $('#object_number').attr('data-original-title', 'allowed object number format: 9999999999 (10 digits)')
                                   .tooltip('fixTitle')
                                   .tooltip('show');
            }
            else {
                $('#object_number').tooltip('hide');
            }
        }

        if (!topic) {
            validation = false;
            $('#topic').attr('data-original-title', 'topic is required')
                       .tooltip('fixTitle')
                       .tooltip('show');
        }
        else {
            if (topic.length > 50) {
                validation = false;
                $('#topic').attr('data-original-title', 'allowed topic max length: 50 signs')
                           .tooltip('fixTitle')
                           .tooltip('show');
            }
            else {
                $('#topic').tooltip('hide');
            }
        }

        if (!description) {
            validation = false;
            $('#description').attr('data-original-title', 'description is required')
                             .tooltip('fixTitle')
                             .tooltip('show');
        }
        else {
            if (description.length > 200) {
                validation = false;
                $('#description').attr('data-original-title', 'allowed description max length: 200 signs')
                                 .tooltip('fixTitle')
                                 .tooltip('show');
            }
            else {
                $('#description').tooltip('hide');
            }
        }

        if (validation) {
            var confirmation = confirm("are you sure you want to add such fault??");

            if (confirmation) {
                return true
            }
        }

        return false;
    }

</script>