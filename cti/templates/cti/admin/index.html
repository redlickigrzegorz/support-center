{% extends 'cti/admin/base.html' %}

{% block title %}{{ header }}{% endblock %}

{% block header %}{{ header }}{% endblock %}

{% block body %}
    <div class="content-row">
        <div class="row message-row">
            {% if messages %}
                <div class="alert">
                {% for message in messages %}
                    <div class="alert-{{ message.tags }}">
                        {% if message.tags == 'success' %}
                            <span class="glyphicon glyphicon-ok"></span>
                        {% else %}
                            <span class="glyphicon glyphicon-remove"></span>
                        {% endif %}
                        <span>{{ message }}</span>
                    </div>
                {% endfor %}
                </div>
            {% endif %}
        </div>
        <table id="myTable" class="tablesorter">
            <thead>
                <tr>
                    <th>created at</th>
                    <th>updated at</th>
                    <th>object number</th>
                    <th>topic</th>
                    <th>issuer</th>
                    <th>phone number</th>
                    <th>handler</th>
                    <th>priority</th>
                    <th>status</th>
                </tr>
            </thead>
            <tbody>
                {% for fault in faults %}
                    <tr data-toggle="modal" data-target="#fault-{{ fault.id }}">
                        <td>{{ fault.created_at|date:'Y-m-d H:i' }}</td>
                        <td>{{ fault.updated_at|date:'Y-m-d H:i' }}</td>
                        <td>{{ fault.object_number }}</td>
                        <td>{{ fault.topic }}</td>
                        <td>{{ fault.issuer }}</td>
                        <td>{{ fault.phone_number }}</td>
                        <td>
                            {% if fault.handler != '0' %}
                                {{ fault.handler }}
                            {% else %}
                                <span>non handler</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if fault.priority == 0 %}
                                <span>trivial</span>
                            {% elif fault.priority == 1 %}
                                <span>standard</span>
                            {% elif fault.priority == 2 %}
                                <span>urgent</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="status">{{ fault.status }}</span>
                            {% if fault.status == 0 %}
                                <span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span>
                            {% elif fault.status == 1 %}
                                <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
                            {% elif fault.status == 2 %}
                                <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% for fault in faults %}
        <div id="fault-{{ fault.id }}" class="modal fade">
            <div class="modal-dialog modal-lg" role="document">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="panel-row row">
                            <div class="col-xs-2 col-sm-2 col-md-2 status-div">
                                {% if fault.status == 0 %}
                                    <span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span>
                                {% elif fault.status == 1 %}
                                    <span class="glyphicon glyphicon-wrench" aria-hidden="true">  </span>
                                {% elif fault.status == 2 %}
                                    <span class="glyphicon glyphicon-check" aria-hidden="true">  </span>
                                {% endif %}
                            </div>
                            <div class="col-xs-10 col-sm-10 col-md-10">
                                <div class="panel-row row">
                                    <div class="col-xs-6 col-sm-6 col-md-6 starting-div header-div">
                                        {{ fault.topic }}
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6 ending-div">
                                        {{ fault.created_at }}
                                    </div>
                                </div>
                                <hr class="hr-bottom-divider">
                                <div class="panel-row row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 starting-div">
                                        <b>status:</b>
                                        {% if fault.status == 0 %}
                                            not started
                                        {% elif fault.status == 1 %}
                                            queued
                                        {% elif fault.status == 2 %}
                                            completed
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="panel-row row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 starting-div">
                                        <b>priority:</b>
                                        {% if fault.priority == 0 %}
                                            trivial
                                        {% elif fault.priority == 1 %}
                                            standard
                                        {% elif fault.priority == 2 %}
                                            urgent
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="panel-row row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 starting-div">
                                        <b>handler:</b>
                                        {% if fault.handler == "0" %}
                                            none
                                        {% else %}
                                            {{ fault.handler }}
                                        {% endif %}
                                    </div>
                                </div>
                                <a href="{% url 'cti:object_details' fault.object_number %}" class="panel-button">
                                    <div class="panel-row row">
                                        <div class="col-xs-12 col-sm-12 col-md-12 starting-div">
                                            <b>object number:</b> {{ fault.object_number }}
                                        </div>
                                    </div>
                                </a>
                                <hr class="hr-bottom-divider">
                                <div class="panel-row row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 starting-div">
                                        {{ fault.description }}
                                    </div>
                                </div>
                                <hr class="hr-top-divider">
                                <div class="panel-row row">
                                    <div class="col-xs-6 col-sm-6 col-md-6 starting-div">
                                        last update: {{ fault.updated_at }}
                                    </div>
                                    <div class="col-xs-6 col-sm-6 col-md-6 ending-div">
                                        created by {{ fault.issuer }} (phone number: {{ fault.phone_number }})
                                    </div>
                                </div>
                                <hr class="hr-top-divider">
                                <div class="panel-row row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 ending-div">
                                        <a href="{% url 'cti:edit_fault' fault.id %}" class="button">edit</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% endblock %}